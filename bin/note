#!/bin/bash

command -v zenity > /dev/null
if [ $? -eq 1 ]; then
    echo "zenity nu este instalat"
    exit
fi

# todo calea de salvare sa fie salvata in $HOME/fastnote implicit. cu posibilitate de setare in sesiune?
FASTNOTE_DIR="$HOME/Dropbox/Desktop/fastnote"
mkdir -p "$FASTNOTE_DIR"

if [ -z "$1" ]; then 
    zenity --error --text="Specifică un nume de fișier"
    exit 1
fi

FILEPATH="$FASTNOTE_DIR/$1"

if [ ! -f "$FILEPATH" ]; then
    touch "$FILEPATH"
fi

SRC=$( cat "$FILEPATH" )
if [ ! -z "$SRC" ]; then
    SRC="$SRC"$'\n────────────────────────────────────────────────────────────────────────────────────────────────────\n' 
fi

SRC="$SRC"$( printf "tags: %s\n" $( date --iso-8601 ) )

RESULT=$( zenity \
    --text-info \
    --editable \
    --font="Terminus 11" \
    --title="$1" \
    --width=900 \
    --height=600 \
    < <( printf "%s" "$SRC" ) \
)

if [ $? -eq 0 ]; then
    printf "%s" "$RESULT" > "$FILEPATH"
fi

