#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
    selected=$1
else
    items="$(tmux-sessionizer-paths)"

    if [ -t 0 ]; then
        selected=$(printf "%s" "$items" | sort | fzf)
    else
        selected=$(printf "%s" "$items" | sort | dmenu -i -l 10 -p 'Alege un proiect:' -fn 'Terminus:regular:size=12')
    fi
fi

if [ -z "$selected" ]; then
    exit
fi

tmux_session_name=$(basename "$selected" | tr . _)

tmux switch-client -t "$tmux_session_name" 2>/dev/null
if [[ $? -eq 0 ]]; then
    exit 0
fi

tmux new-session -d -c "$selected" -s "$tmux_session_name" && tmux switch-client -t "$tmux_session_name" || tmux new -c "$selected" -A -s "$tmux_session_name"
