#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
    selected=$1
else
    if [ -z "$TMUX_SESSIONIZER_PATHS" ]; then
        echo "TMUX_SESSIONIZER_PATHS is not defined"
        exit 1
    fi

    items="$TMUX_SESSIONIZER_PATHS"
    selected=$(printf "%s" "$items" | sort | fzf)
fi

if [ -z "$selected" ]; then
    exit
fi

tmux_session_name=$(basename "$selected" | tr . _)

tmux switch-client -t "$tmux_session_name" 2>/dev/null
if [[ $? -eq 0 ]]; then
    exit 0
fi

tmux new-session -d -c "$selected" -s "$tmux_session_name" && tmux switch-client -t "$tmux_session_name" || tmux new -c "$selected" -A -s "$tmux_session_name"
